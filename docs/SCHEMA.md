# Destination Data Schema

This document defines the complete data model for destinations in the Otherwhere system.

## Overview

The schema is **shared across** TypeScript (frontend), Go (backend), and Python (data ingestion) to ensure consistency.

## Core Principles

1. **All features are normalized to [0, 1]** for consistent ranking
2. **Geographic metadata is separate from features** for clear filtering vs ranking
3. **Schema is identical** across all three languages (TypeScript, Go, Python)

---

## Types

### DestinationType

Whether the destination is a city or a broader region.

```
"city" | "region"
```

**Examples:**
- City: Lisbon, Kyoto, Medellín
- Region: Algarve, Bali, Patagonia

### Continent

Major geographic regions for broad filtering.

```
"Europe" | "Asia" | "Africa" | "North America" | "South America" | "Oceania"
```

---

## Destination Object

### Structure

```json
{
  "id": "pt-lagos",
  "name": "Lagos",
  "country": "Portugal",
  "continent": "Europe",
  "region": "Algarve",
  "type": "city",
  "location": {
    "lat": 37.1028,
    "lon": -8.6731
  },
  "features": {
    "avg_temp_c": 0.65,
    "tourism_density": 0.22,
    "wikipedia_pageviews": 0.15,
    "accommodation_density": 0.31,
    "population": 0.08,
    "population_density": 0.28,
    "coast_distance_km": 0.02,
    "nature_ratio": 0.62,
    "elevation": 0.10,
    "skiing_score": 0.0,
    "water_sports_score": 0.85,
    "hiking_score": 0.45,
    "wildlife_score": 0.15,
    "nightlife_density": 0.08,
    "development_level": 0.78,
    "gdp_per_capita": 0.72
  },
  "images": [
    "https://commons.wikimedia.org/wiki/File:Lagos_beach.jpg"
  ],
  "description": "Coastal town in the Algarve region..."
}
```

---

## Features Explained

All features are **normalized to [0, 1]** where possible.

### Climate

| Feature | Description | Normalization |
|---------|-------------|---------------|
| `avg_temp_c` | Average annual temperature | Scaled from -10°C to 40°C |

### Tourism & Popularity

| Feature | Description | Normalization |
|---------|-------------|---------------|
| `tourism_density` | Density of tourism POIs (hotels, attractions) per km² | Percentile across all destinations |
| `wikipedia_pageviews` | Monthly Wikipedia pageviews | Log scale, percentile |
| `accommodation_density` | Hotels and lodging per km² | Percentile |

### Urbanization

| Feature | Description | Normalization |
|---------|-------------|---------------|
| `population` | Total population | Log scale, percentile |
| `population_density` | People per km² | Percentile |

### Nature & Geography

| Feature | Description | Normalization |
|---------|-------------|---------------|
| `coast_distance_km` | Distance to nearest coast | 0 = on coast, max capped at 500km |
| `nature_ratio` | Ratio of parks, forests, beaches in area | Direct percentage [0, 1] |
| `elevation` | Elevation / mountain proximity | Scaled from 0 to 5000m |

### Activities

All activity scores represent **relative availability** based on POI density.

| Feature | Description | Data Sources |
|---------|-------------|--------------|
| `skiing_score` | Ski resorts, lifts, alpine facilities | OSM amenity tags |
| `water_sports_score` | Beaches, marinas, surf spots, diving | OSM leisure/sport tags |
| `hiking_score` | Trails, national parks, elevation variance | OSM trails, protected areas |
| `wildlife_score` | Protected areas, reserves, biodiversity | UNESCO, WWF data |
| `nightlife_density` | Bars, clubs, entertainment venues | OSM amenity tags |

### Development & Cultural Context

| Feature | Description | Normalization |
|---------|-------------|---------------|
| `development_level` | Modern infrastructure index | Composite of GDP, infrastructure density |
| `gdp_per_capita` | Economic indicator | Percentile across destinations |

---

## Search Constraints

Feature constraints allow filtering destinations by their characteristics.

```typescript
{
  "avg_temp_c": { "min": 0.5, "max": 0.8 },      // 20-30°C
  "tourism_density": { "max": 0.3 },             // Low tourists
  "nature_ratio": { "min": 0.5 }                 // At least 50% nature
}
```

Constraints are generated by:
1. **LLM semantic translation** (primary path)
2. **Predefined vibe tags** (e.g., "chill" → specific constraints)
3. **User-defined filters** (future: manual sliders)

---

## Geographic Filters

Separate from features, used for browsing and narrowing search scope.

```typescript
{
  "continent": "Europe",
  "region": "Mediterranean",
  "country": "Portugal"
}
```

These are **applied first** before vibe-based ranking.

---

## Normalization Strategy

### Why Normalize?

- **Fair comparison** across different scales (population vs temperature)
- **Consistent distance metrics** for ranking
- **Predictable constraint ranges** (always 0-1)

### Methods

| Type | Method | Example |
|------|--------|---------|
| Temperature | Linear scale | -10°C → 0, 40°C → 1 |
| Density metrics | Percentile rank | 90th percentile → 0.9 |
| Ratios | Direct percentage | 60% nature → 0.6 |
| Popularity | Log scale + percentile | High variance data |

---

## File Locations

- **TypeScript:** `frontend/src/types/destination.ts`
- **Go:** `backend/internal/types/destination.go`
- **Python:** `data-ingestion/destination_schema.py`

---

## Adding New Features

To add a new feature:

1. Update all three type definitions
2. Add to normalization logic in Python
3. Update ranking algorithm in Go
4. Document in this file

**Keep the schema in sync across all languages!**
